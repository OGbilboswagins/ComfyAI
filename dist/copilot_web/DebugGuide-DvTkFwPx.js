function getImportPath(filename) {
            return `./${filename}`;
        }
            import{j as o}from"./vendor-markdown-CBmlBP6m.js";import{r as a}from"./vendor-react-Dixhfmvb.js";import{B as D,g as b,a as h,W as w}from"./message-components-BfemXQD4.js";import{c as A}from"./workflowChat-C5do68H6.js";import"./input.js";/* empty css     */import"./App-aIt2YzCk.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],R=A("Undo2",E),O=({checkpointId:l,onRestore:x})=>{const[p,f]=a.useState(!1),n=async()=>{if(!p){f(!0);try{const i=await w.restoreWorkflowCheckpoint(l),u=i.workflow_data_ui||i.workflow_data;u&&(i.workflow_data_ui?h.loadGraphData(u):h.loadApiJson(u),console.log(`Restored workflow checkpoint ${l}`),x())}catch(i){console.error("Failed to restore checkpoint:",i),alert("Failed to restore workflow checkpoint. Please try again.")}finally{f(!1)}}};return o.jsxs("button",{onClick:n,disabled:p,className:`flex flex-row items-center gap-1 p-1 rounded transition-colors ${p?"text-gray-400 cursor-not-allowed":"text-gray-500 hover:!bg-gray-100 hover:!text-gray-600"}`,title:`Restore checkpoint ${l}`,children:[o.jsx(R,{size:12}),o.jsx("span",{className:"text-xs",children:"Restore checkpoint"})]})};function H({content:l,name:x="Assistant",avatar:p,onAddMessage:f,onUpdateMessage:n,onFinishLoad:i,messageId:u}){const[g,_]=a.useState(!1),[J,T]=a.useState(""),[$,S]=a.useState(!1),[j,v]=a.useState(null);a.useEffect(()=>{i?.()},[]);const r=a.useMemo(()=>{try{return JSON.parse(l)}catch(e){return console.error("Failed to parse message content:",e),null}},[l]),y=a.useMemo(()=>{if(!r||!r.ext)return null;const e=r.ext.find(t=>t.type==="debug_start_checkpoint"||t.type==="debug_checkpoint"&&t.data?.checkpoint_type==="debug_start");return e&&e.data&&e.data.checkpoint_id?e.data.checkpoint_id:null},[r])||j,N=async()=>{if(g)return;const e=b(),t={id:e,role:"ai",content:JSON.stringify({text:`ðŸ” Starting workflow analysis...
`,ext:[]}),format:"markdown",name:"Assistant",finished:!1,debugGuide:!0};f?.(t);try{await C(),await I(e)}finally{_(!1)}},C=async()=>{try{const e=await h.graphToPrompt(),t=localStorage.getItem("sessionId")||"";if(t&&e){const s=await w.saveWorkflowCheckpoint(t,e.output,e.workflow,"debug_start");if(v(s.version_id),console.log(`Saved debug start checkpoint: ${s.version_id}`),n&&r){const c=[...r.ext||[]].filter(k=>k.type!=="debug_start_checkpoint"&&!(k.type==="debug_checkpoint"&&k.data?.checkpoint_type==="debug_start"));c.push({type:"debug_start_checkpoint",data:{checkpoint_id:s.version_id,checkpoint_type:"debug_start"}});const m={id:u||b(),role:"ai",content:JSON.stringify({text:r.text,ext:c}),format:"debug_guide",name:"Assistant"};n(m)}}}catch(e){console.error("Failed to save checkpoint before debug:",e)}},I=async e=>{try{const t=await h.graphToPrompt();let s="",d=null;for await(const c of w.streamDebugAgent(t))if(c.text){s=c.text,c.ext&&(d=c.ext);const m={id:e,role:"ai",content:JSON.stringify({text:s,ext:d||[]}),format:"markdown",name:"Assistant",finished:!1,debugGuide:!0};n?.(m)}n?.({id:e,role:"ai",content:JSON.stringify({text:s,ext:d||[]}),format:"markdown",name:"Assistant",finished:!0,debugGuide:!0})}catch(t){console.error("Error calling debug agent:",t),S(!1);const d={id:e,role:"ai",content:JSON.stringify({text:`I encountered an error while analyzing your workflow: ${t.message||"Unknown error"}`,ext:[]}),format:"markdown",name:"Assistant",finished:!0};n?.(d)}};return r?o.jsx(D,{name:x,children:o.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[o.jsx("div",{className:"flex justify-between items-start",children:o.jsx("p",{className:"text-gray-700 text-sm flex-1",children:r.text})}),o.jsx("div",{className:"flex mt-4",children:o.jsx("button",{onClick:N,disabled:g,className:`px-4 py-2 text-white text-sm rounded-md transition-colors ${g?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"}`,children:g?"Analyzing...":"Debug Errors"})}),o.jsx("div",{className:"flex justify-end mt-2",children:y&&o.jsx("div",{className:"ml-2 flex-shrink-0",children:o.jsx(O,{checkpointId:y,onRestore:()=>{console.log("Workflow restored from checkpoint")}})})})]})}):null}export{H as DebugGuide};
